{
  "ruleChain": {
    "name": "NEST Device",
    "type": "CORE",
    "firstRuleNodeId": null,
    "root": false,
    "debugMode": false,
    "configuration": null,
    "additionalInfo": {
      "description": ""
    }
  },
  "metadata": {
    "version": 67,
    "firstNodeIndex": 1,
    "nodes": [
      {
        "type": "org.thingsboard.rule.engine.filter.TbCheckMessageNode",
        "name": "Check Telemetry",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "messageNames": [
            "temperature",
            "humidity",
            "weight",
            "uid"
          ],
          "metadataNames": [],
          "checkAllKeys": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 578,
          "layoutY": 330
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode",
        "name": "Check Message Type",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "version": 0
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 276,
          "layoutY": 151
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Incorrect Message Syntax",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "useMessageAlarmData": false,
          "alarmType": "incorrect message syntax",
          "severity": "MAJOR",
          "propagate": false,
          "relationTypes": []
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1058,
          "layoutY": 134
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbClearAlarmNode",
        "name": "Close Incorrect Message Syntax Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmType": "incorrect message syntax"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1061,
          "layoutY": 205
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check Temperature",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "maxTemp = metadata.cs_maxTemp;\nminTemp = metadata.cs_minTemp;\n\nif(msg.temperature<minTemp||msg.temperature>maxTemp){\n    return true;\n}else return false;"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1061,
          "layoutY": 338
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check Humidity",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "maxHum = metadata.cs_maxHum;\nminHum = metadata.cs_minHum;\n\nif(msg.humidity<minHum||msg.humidity>maxHum){\n    return true;\n}else return false;"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1060,
          "layoutY": 487
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check UID",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "validUID = metadata.cs_validUID;\nhenUID = metadata.cs_henUID;\n\nif(msg.uid==validUID || msg.uid==henUID){\n    return true;\n}else return false;"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1048,
          "layoutY": 621
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Temperature Out of Bounds Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "JS",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmDetailsBuildTbel": null,
          "useMessageAlarmData": false,
          "overwriteAlarmDetails": null,
          "alarmType": "Temperature Out of Bounds",
          "severity": "MAJOR",
          "propagate": false,
          "relationTypes": [],
          "propagateToOwner": null,
          "propagateToTenant": null,
          "dynamicSeverity": null
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1307,
          "layoutY": 300
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbClearAlarmNode",
        "name": "Close Temperature Out of Bounds Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "JS",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmDetailsBuildTbel": null,
          "alarmType": "Temperature Out of Bounds"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1307,
          "layoutY": 372
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Humidity Out of Bounds Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "JS",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmDetailsBuildTbel": null,
          "useMessageAlarmData": false,
          "overwriteAlarmDetails": null,
          "alarmType": "Humidity Out of Bounds",
          "severity": "MAJOR",
          "propagate": false,
          "relationTypes": [],
          "propagateToOwner": null,
          "propagateToTenant": null,
          "dynamicSeverity": null
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1306,
          "layoutY": 457
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbClearAlarmNode",
        "name": "Close Humidity Out of Bounds Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "JS",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmDetailsBuildTbel": null,
          "alarmType": "Humidity Out of Bounds"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1308,
          "layoutY": 519
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Open Door",
        "debugMode": true,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "",
          "tbelScript": "validUID = metadata.cs_validUID;\ndoorStatus = metadata.shared_door;\n\nif(msg.uid==validUID){\n    \n    if(doorStatus==\"open\"){\n        msg.attributes = {\n            door: \"closed\",\n            rgb: \"Green\"\n        }\n    } else {\n        msg.attributes = {\n            door: \"open\",\n            rgb: \"Green\"\n        }\n    }\n    \n    \n\n}else{msg.attributes = {}}\n\nmetadata.attributesScope = \"SHARED_SCOPE\";\n\n\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1309,
          "layoutY": 586
        }
      },
      {
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode",
        "name": "save data from sensor",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "defaultTTL": 0
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1062,
          "layoutY": 265
        }
      },
      {
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode",
        "name": "Save Shared Attributes",
        "debugMode": true,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 2,
        "configuration": {
          "scope": "SHARED_SCOPE",
          "notifyDevice": false,
          "sendAttributesUpdatedNotification": false,
          "updateAttributesOnlyOnValueChange": true
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1634,
          "layoutY": 754
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "TempRange",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [
            "maxTemp",
            "minTemp"
          ],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 790,
          "layoutY": 337
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "UIDs",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [
            "validUID",
            "henUID"
          ],
          "sharedAttributeNames": [
            "door"
          ],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 793,
          "layoutY": 620
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "FSM",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [
            "minWeight",
            "avgWeight",
            "henUID",
            "validUID"
          ],
          "sharedAttributeNames": [
            "state"
          ],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 783,
          "layoutY": 866
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "HumRange",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [
            "maxHum",
            "minHum"
          ],
          "sharedAttributeNames": [],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 790,
          "layoutY": 487
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Reject Door Use",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "if(msg.uid!=\"None\"){\n    \n    msg.attributes = {\n        rgb: \"Red\"\n    }\n    \n\n}else {msg.attributes = {}}\n\nmetadata.attributesScope = \"SHARED_SCOPE\";\n\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1313,
          "layoutY": 670
        }
      },
      {
        "type": "org.thingsboard.rule.engine.metadata.TbGetAttributesNode",
        "name": "RGB",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 1,
        "configuration": {
          "tellFailureIfAbsent": true,
          "fetchTo": "METADATA",
          "clientAttributeNames": [],
          "sharedAttributeNames": [
            "rgb"
          ],
          "serverAttributeNames": [],
          "latestTsKeyNames": [],
          "getLatestValueWithTs": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 787,
          "layoutY": 743
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check RGB",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "rgbStatus = metadata.shared_rgb;\n\nif(rgbStatus!=\"Off\"){\n    return true;\n} else return false;\n"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1051,
          "layoutY": 744
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Turn Off RGB",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "msg.attributes = {\n    rgb: \"Off\"\n}\n    \nmetadata.attributesScope = \"SHARED_SCOPE\";\n\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1312,
          "layoutY": 754
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Check FSM State",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "stateFSM = metadata.shared_state;\nhenUID = metadata.cs_henUID;\nvalidUID = metadata.cs_validUID;\nminWeight = metadata.cs_minWeight;\n\nif(stateFSM==\"Waiting for Hen\"){\n    \n    if(msg.uid==henUID){\n        return true;\n    } else return false;\n    \n} else if (stateFSM==\"Hen Inside\") {\n        \n    if(msg.uid!=henUID){\n        return true;\n    } else return false;\n    \n} else if (stateFSM==\"Eggs Inside\") {\n        \n    if(msg.uid==validUID){\n        return true;\n    } else return false;\n    \n} else if (stateFSM==\"Recolecting Eggs\") {\n        \n    if(msg.weight < minWeight){\n        return true;\n    } else return false;\n    \n} else return false;\n"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1046,
          "layoutY": 869
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Change FSM State",
        "debugMode": true,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "stateFSM = metadata.shared_state;\r\navgWeight = metadata.cs_avgWeight;\r\nminWeight = metadata.cs_minWeight;\r\n\r\nif (stateFSM == \"Waiting for Hen\") {\r\n    msg.attributes = { \r\n        state: \"Hen Inside\", \r\n        eggs: \"--\" \r\n        \r\n    };\r\n} else if (stateFSM == \"Hen Inside\") {\r\n    if (msg.weight < minWeight) {\r\n        msg.attributes = { \r\n            state: \"Waiting for Hen\", \r\n            eggs: 0 \r\n            \r\n        };\r\n    } else {\r\n        var estimatedEggs = Math.round(msg.weight / avgWeight);\r\n        msg.attributes = { \r\n            state: \"Eggs Inside\", \r\n            eggs: estimatedEggs,\r\n            door: \"closed\" \r\n            \r\n        }; \r\n    }\r\n} else if (stateFSM == \"Eggs Inside\") {\r\n    msg.attributes = { \r\n        state: \"Recolecting Eggs\" \r\n    };\r\n} else if (stateFSM == \"Recolecting Eggs\") {\r\n    msg.attributes = { \r\n        state: \"Waiting for Hen\", \r\n        eggs: 0 \r\n    };\r\n} else {msg.attributes = {}}\r\n\r\nmetadata.attributesScope = \"SHARED_SCOPE\";\r\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\r\n\r\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1315,
          "layoutY": 866
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbCheckMessageNode",
        "name": "Check Initialization",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "messageNames": [
            "init"
          ],
          "metadataNames": [],
          "checkAllKeys": true
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 572,
          "layoutY": 962
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "Device Initialization",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "msg.attributes = {\n    rgb: \"Off\",\n    door: \"open\",\n    eggs: 0,\n    state: \"Waiting for Hen\"\n}\n    \nmetadata.attributesScope = \"SHARED_SCOPE\";\n\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn { msg: msg.attributes, metadata: metadata, msgType: msgType }"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1318,
          "layoutY": 961
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbCheckMessageNode",
        "name": "Check Error",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "messageNames": [
            "error"
          ],
          "metadataNames": [],
          "checkAllKeys": true
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 588,
          "layoutY": 19
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Hardware Error",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
          "alarmDetailsBuildTbel": "var details = {\r\n    errorMsg: msg.error,\r\n    timestamp: new Date().toISOString()\r\n};\r\nreturn details;",
          "useMessageAlarmData": false,
          "overwriteAlarmDetails": false,
          "alarmType": "Hardware Error",
          "severity": "CRITICAL",
          "propagate": false,
          "relationTypes": [],
          "propagateToOwner": false,
          "propagateToTenant": false,
          "dynamicSeverity": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1052,
          "layoutY": 3
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbClearAlarmNode",
        "name": "Close Hardware Error",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
          "alarmDetailsBuildTbel": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n}\nreturn details;",
          "alarmType": "Harware Error"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1049,
          "layoutY": 60
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbCheckMessageNode",
        "name": "Check Attributes",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "messageNames": [
            "latitude",
            "longitude",
            "maxTemp",
            "minTemp",
            "maxHum",
            "minHum",
            "avgWeight",
            "minWeight",
            "validUID",
            "henUID"
          ],
          "metadataNames": [],
          "checkAllKeys": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 573,
          "layoutY": 1098
        }
      },
      {
        "type": "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode",
        "name": "Save Client Attributes",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 2,
        "configuration": {
          "scope": "CLIENT_SCOPE",
          "notifyDevice": false,
          "sendAttributesUpdatedNotification": false,
          "updateAttributesOnlyOnValueChange": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1028,
          "layoutY": 1099
        }
      },
      {
        "type": "org.thingsboard.rule.engine.rest.TbRestApiCallNode",
        "name": "Telegram Temp Alarm",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 3,
        "configuration": {
          "restEndpointUrlPattern": "https://api.telegram.org/bot8560879729:AAEHgMY-NWSmXSejZ07uWvmfoxJfSWEWbCw/sendMessage",
          "requestMethod": "POST",
          "useSimpleClientHttpFactory": false,
          "parseToPlainText": false,
          "ignoreRequestBody": false,
          "enableProxy": false,
          "useSystemProxyProperties": false,
          "proxyScheme": null,
          "proxyHost": null,
          "proxyPort": 0,
          "proxyUser": null,
          "proxyPassword": null,
          "readTimeoutMs": 0,
          "maxParallelRequestsCount": 0,
          "headers": {
            "Content-Type": "application/json"
          },
          "credentials": {
            "type": "anonymous"
          },
          "maxInMemoryBufferSizeInKb": 256
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1940,
          "layoutY": 333
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "New Telegram Message",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "var newMsg ={};\r\nnewMsg.text = '\"' +  msg.name + '\"' + \" alarm was created for device: \" + '\"' + metadata.deviceName + '\"';\r\nnewMsg.chat_id = 1624527516;\r\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1652,
          "layoutY": 161
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "New Telegram Message",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "var newMsg ={};\r\nnewMsg.text = '\"' +  msg.name + '\"' + \" alarm cleared for device: \" + '\"' + metadata.deviceName + '\"';\r\nnewMsg.chat_id = 1624527516;\r\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1657,
          "layoutY": 446
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbJsFilterNode",
        "name": "Eggs Inside",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return msg.temperature > 20;",
          "tbelScript": "return msg.eggs > 0;"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1634,
          "layoutY": 967
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbCreateAlarmNode",
        "name": "Eggs Inside",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
          "alarmDetailsBuildTbel": "var details = {\r\n    message: \"Eggs detected! Count: \" + msg.eggs,\r\n    state: msg.state,\r\n    timestamp: new Date().toISOString()\r\n};\r\nreturn details;",
          "useMessageAlarmData": false,
          "overwriteAlarmDetails": false,
          "alarmType": "Eggs Inside",
          "severity": "CRITICAL",
          "propagate": false,
          "relationTypes": [],
          "propagateToOwner": false,
          "propagateToTenant": false,
          "dynamicSeverity": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1863,
          "layoutY": 901
        }
      },
      {
        "type": "org.thingsboard.rule.engine.action.TbClearAlarmNode",
        "name": "No Eggs Inside",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "alarmDetailsBuildJs": "var details = {};\nif (metadata.prevAlarmDetails) {\n    details = JSON.parse(metadata.prevAlarmDetails);\n    //remove prevAlarmDetails from metadata\n    delete metadata.prevAlarmDetails;\n    //now metadata is the same as it comes IN this rule node\n}\n\n\nreturn details;",
          "alarmDetailsBuildTbel": "var details = {\r\n    message: \"Eggs Recolected\",\r\n    state: msg.state\r\n};\r\nreturn details;",
          "alarmType": "Eggs Inside"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 1861,
          "layoutY": 1024
        }
      },
      {
        "type": "org.thingsboard.rule.engine.transform.TbTransformMsgNode",
        "name": "New Telegram Message",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "scriptLang": "TBEL",
          "jsScript": "return {msg: msg, metadata: metadata, msgType: msgType};",
          "tbelScript": "var newMsg ={};\r\nnewMsg.text = msg.details.message + \" \" + '(\"' + metadata.deviceName + '\")';\r\nnewMsg.chat_id = 1624527516;\r\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 2119,
          "layoutY": 954
        }
      },
      {
        "type": "org.thingsboard.rule.engine.filter.TbCheckMessageNode",
        "name": "Check Telemetry Message",
        "debugMode": false,
        "singletonMode": false,
        "queueName": null,
        "configurationVersion": 0,
        "configuration": {
          "messageNames": [
            "temperature",
            "humidity",
            "weight",
            "uid",
            "error",
            "init"
          ],
          "metadataNames": [],
          "checkAllKeys": false
        },
        "additionalInfo": {
          "description": "",
          "layoutX": 576,
          "layoutY": 183
        }
      }
    ],
    "connections": [
      {
        "fromIndex": 0,
        "toIndex": 14,
        "type": "True"
      },
      {
        "fromIndex": 0,
        "toIndex": 15,
        "type": "True"
      },
      {
        "fromIndex": 0,
        "toIndex": 16,
        "type": "True"
      },
      {
        "fromIndex": 0,
        "toIndex": 17,
        "type": "True"
      },
      {
        "fromIndex": 0,
        "toIndex": 19,
        "type": "True"
      },
      {
        "fromIndex": 1,
        "toIndex": 0,
        "type": "Post telemetry"
      },
      {
        "fromIndex": 1,
        "toIndex": 24,
        "type": "Post telemetry"
      },
      {
        "fromIndex": 1,
        "toIndex": 26,
        "type": "Post telemetry"
      },
      {
        "fromIndex": 1,
        "toIndex": 29,
        "type": "Post attributes"
      },
      {
        "fromIndex": 1,
        "toIndex": 38,
        "type": "Post telemetry"
      },
      {
        "fromIndex": 4,
        "toIndex": 7,
        "type": "True"
      },
      {
        "fromIndex": 4,
        "toIndex": 8,
        "type": "False"
      },
      {
        "fromIndex": 5,
        "toIndex": 9,
        "type": "True"
      },
      {
        "fromIndex": 5,
        "toIndex": 10,
        "type": "False"
      },
      {
        "fromIndex": 6,
        "toIndex": 11,
        "type": "True"
      },
      {
        "fromIndex": 6,
        "toIndex": 18,
        "type": "False"
      },
      {
        "fromIndex": 7,
        "toIndex": 32,
        "type": "Created"
      },
      {
        "fromIndex": 8,
        "toIndex": 33,
        "type": "Cleared"
      },
      {
        "fromIndex": 9,
        "toIndex": 32,
        "type": "Created"
      },
      {
        "fromIndex": 10,
        "toIndex": 33,
        "type": "Cleared"
      },
      {
        "fromIndex": 11,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 14,
        "toIndex": 4,
        "type": "Success"
      },
      {
        "fromIndex": 15,
        "toIndex": 6,
        "type": "Success"
      },
      {
        "fromIndex": 16,
        "toIndex": 22,
        "type": "Success"
      },
      {
        "fromIndex": 17,
        "toIndex": 5,
        "type": "Success"
      },
      {
        "fromIndex": 18,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 19,
        "toIndex": 20,
        "type": "Success"
      },
      {
        "fromIndex": 20,
        "toIndex": 21,
        "type": "True"
      },
      {
        "fromIndex": 21,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 22,
        "toIndex": 23,
        "type": "True"
      },
      {
        "fromIndex": 23,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 23,
        "toIndex": 34,
        "type": "Success"
      },
      {
        "fromIndex": 24,
        "toIndex": 25,
        "type": "True"
      },
      {
        "fromIndex": 25,
        "toIndex": 13,
        "type": "Success"
      },
      {
        "fromIndex": 26,
        "toIndex": 27,
        "type": "True"
      },
      {
        "fromIndex": 26,
        "toIndex": 28,
        "type": "False"
      },
      {
        "fromIndex": 27,
        "toIndex": 32,
        "type": "Created"
      },
      {
        "fromIndex": 28,
        "toIndex": 33,
        "type": "Cleared"
      },
      {
        "fromIndex": 29,
        "toIndex": 30,
        "type": "True"
      },
      {
        "fromIndex": 32,
        "toIndex": 31,
        "type": "Success"
      },
      {
        "fromIndex": 33,
        "toIndex": 31,
        "type": "Success"
      },
      {
        "fromIndex": 34,
        "toIndex": 35,
        "type": "True"
      },
      {
        "fromIndex": 34,
        "toIndex": 36,
        "type": "False"
      },
      {
        "fromIndex": 35,
        "toIndex": 37,
        "type": "Created"
      },
      {
        "fromIndex": 36,
        "toIndex": 37,
        "type": "Cleared"
      },
      {
        "fromIndex": 37,
        "toIndex": 31,
        "type": "Success"
      },
      {
        "fromIndex": 38,
        "toIndex": 2,
        "type": "False"
      },
      {
        "fromIndex": 38,
        "toIndex": 3,
        "type": "True"
      },
      {
        "fromIndex": 38,
        "toIndex": 12,
        "type": "True"
      }
    ],
    "ruleChainConnections": null
  }
}